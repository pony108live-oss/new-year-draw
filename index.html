<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta property="og:title" content="✨ 2026 新年小禮物抽籤 ✨">
    <meta property="og:description" content="點擊進入，抽一個屬於你的新年好運號碼吧！">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://pony108live-oss.github.io/new-year-draw/">
    <meta property="og:image" content="https://raw.githubusercontent.com/pony108live-oss/new-year-draw/main/preview.jpg">
    
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2026 新年小禮物抽籤</title>
    
    <link href="https://fonts.googleapis.com/css2?family=ZCOOL+KuaiLe&family=Noto+Sans+TC:wght@500&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --primary-color: #ff9a9e;
            --accent-color: #fad0c4;
            --text-color: #5d5d5d;
        }

        /* 全螢幕漸層粉色背景 */
        body {
            font-family: 'Noto Sans TC', sans-serif;
            background: linear-gradient(135deg, #ffefef 0%, #ffe3e3 100%) !important;
            background-attachment: fixed;
            min-height: 100vh;
            margin: 0;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .container {
            background: rgba(255, 255, 255, 0.85);
            backdrop-filter: blur(10px);
            width: 85%;
            max-width: 380px;
            padding: 40px 20px;
            border-radius: 30px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.05);
            text-align: center;
            border: 2px solid white;
        }

        .user-profile img {
            width: 75px;
            height: 75px;
            border-radius: 50%;
            border: 4px solid #fff;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }

        h2 {
            font-family: 'ZCOOL KuaiLe', cursive;
            font-size: 28px;
            color: #ff7675;
            margin-top: 15px;
        }

        .lucky-box {
            margin: 40px 0;
            min-height: 100px;
        }

        #number-display {
            font-size: 80px;
            font-weight: bold;
            color: #fab1a0;
            text-shadow: 2px 2px 0px #fff;
        }

        .btn {
            background: linear-gradient(to right, #ff9a9e 0%, #fecfef 100%);
            color: white;
            border: none;
            padding: 15px 40px;
            font-size: 20px;
            font-weight: bold;
            border-radius: 50px;
            cursor: pointer;
            width: 90%;
            transition: 0.3s;
            box-shadow: 0 5px 15px rgba(255, 154, 158, 0.4);
        }

        .btn:active { transform: scale(0.95); }
        .btn:disabled { background: #dcdde1; cursor: not-allowed; box-shadow: none; }

        .hint { color: #a2a2a2; font-size: 13px; margin-top: 20px; }
    </style>
</head>
<body>

<div class="container">
    <div class="user-profile" id="user-profile">
        <div style="width:75px; height:75px; background:#f0f0f0; border-radius:50%; margin:auto;"></div>
        <p>正在準備驚喜...</p>
    </div>

    <h2>✨ 2026新年小禮物 ✨</h2>
    
    <div class="lucky-box">
        <div id="number-display">?</div>
    </div>

    <button id="draw-btn" class="btn" onclick="runLottery()">開始抽籤</button>
    <p class="hint">每人限抽一次，祝你新年好運！</p>
</div>

<script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
<script>
const LIFF_ID = "2008809071-dLtcXpov";
const GAS_URL = "https://script.google.com/macros/s/AKfycbxzxWehvFTeb3e8gfk4bqx2ecWJ_RSqtlzOpwv0oOE18g-3ZE_f_5uxRESXWoTOKKKg/exec";

let userProfile = null;
let isDrawing = false;

async function initLIFF() {
    try {
        await liff.init({ liffId: LIFF_ID }); 
        if (!liff.isLoggedIn()) {
            liff.login();
        } else {
            userProfile = await liff.getProfile();
            document.getElementById('user-profile').innerHTML = `
                <img src="${userProfile.pictureUrl}" alt="profile">
                <p>Hi <strong>${userProfile.displayName}</strong>，抽個好運吧！</p>
            `;
        }
    } catch (err) {
        console.error("LIFF 初始化失敗", err);
    }
}

async function runLottery() {
    if (isDrawing || !userProfile) return;
    isDrawing = true;
    
    const btn = document.getElementById('draw-btn');
    const display = document.getElementById('number-display');
    btn.disabled = true;
    btn.innerText = "好運降臨中...";

    let count = 0;
    const totalSpins = 35; 
    const timer = setInterval(() => {
        display.innerText = Math.floor(Math.random() * 24) + 1;
        count++;
        if (count >= totalSpins) {
            clearInterval(timer);
            finishDraw(); 
        }
    }, 60);
}

async function finishDraw() {
    const display = document.getElementById('number-display');
    const btn = document.getElementById('draw-btn');
    
    try {
        const response = await fetch(GAS_URL, {
            method: "POST",
            body: JSON.stringify({
                userId: userProfile.userId,
                userName: userProfile.displayName
            })
        });
        
        const result = await response.json();

        if (result.status === "success") {
            display.innerText = result.number;
            display.style.color = "#d63031";
            btn.innerText = "已完成抽籤，請等候公佈！";
        } else {
            alert(result.message);
            display.innerText = "!";
            btn.innerText = "抽籤結束";
        }
    } catch (e) {
        console.error("傳送失敗", e);
        alert("系統連線異常，請稍後再試！");
        isDrawing = false;
        btn.disabled = false;
        btn.innerText = "重新抽籤";
    }
}

initLIFF();
</script>
</body>
</html>

